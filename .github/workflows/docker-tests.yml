name: Docker Tests
permissions:
  contents: read

on: push

jobs:
  docker-tests:
    permissions:
      contents: read
      actions: write
    timeout-minutes: 20
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: ./.github/actions/setup-pnpm

      - name: Cache Playwright browsers (optional)
        uses: actions/cache@v4
        with:
          path: ~/.cache/ms-playwright
          key: playwright-${{ runner.os }}-${{ hashFiles('pnpm-lock.yaml') }}

      - name: Workspace init (installs browsers + Lexical)
        env:
          PLAYWRIGHT_INSTALL: "true"
        run: pnpm run dev:init

      - name: Run Docker smoke tests
        run: pnpm run test:e2e:prod
